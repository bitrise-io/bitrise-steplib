#
# A Bitrise.io Step for building and running LinkedIn's bluepill parallel iOS testing software
# https://github.com/linkedin/bluepill
#

title: |-
  Bluepill Build/Test for iOS
summary: |
  Build and run parallel UI/Unit tests for iOS using LinkedIn's bluepill testing tool
description: |
  Run tests in parallel by using multiple simulators. Generate a JUnit report after each test run.
website: https://github.com/HealthEngineAU/bitrise-step-bluepill-build-test-for-ios
source_code_url: https://github.com/HealthEngineAU/bitrise-step-bluepill-build-test-for-ios
support_url: https://github.com/HealthEngineAU/bitrise-step-bluepill-build-test-for-ios/issues
host_os_tags:
  - osx-10.10
  - ubuntu-16.04
project_type_tags:
  - ios
type_tags:
  - test

is_requires_admin_user: true
is_always_run: false
is_skippable: false
run_if: ""

deps:
  brew:
  - name: git
  - name: wget
  apt_get:
  - name: git
  - name: wget


toolkit:
  bash:
    entry_file: step.sh


inputs:
  - app_name: MyApp
    opts:
      title: "App Name"
      summary: "App name in bundle (e.g. 'MyApp')"
      is_expand: true
      is_required: true
  - workspace: ""
    opts:
      title: "Workspace Name"
      summary: "Xcode Workspace File (e.g. MyApp.xcworkspace)"
      is_expand: true
      is_required: true
  - scheme: ""
    opts:
      title: "Scheme"
      summary: "Xcode Scheme (e.g. 'MyApp')"
      is_expand: true
      is_required: true
  - derived_data_path: "build"
    opts:
      title: "Derived Data Path"
      summary: "Derived data path (e.g. 'build')"
      is_expand: true
      is_required: true
  - bluepill_output_dir: "bluepill-output"
    opts:
      title: "Directory for Bluepill logs/results"
      summary: "Directory to place all the bluepill logs/results files."
      is_expand: true
      is_required: true
  - device_type: "iPhone 6"
    opts:
      title: "Device Type"
      summary: "iOS Device to build/run (e.g. 'iPhone 6', 'iPad Pro (12.9-inch)')"
      is_expand: true
      is_required: false
  - ios_version: "12.2"
    opts:
      title: "iOS Version"
      summary: "iOS Version to build/run simulators (e.g. '11.0', '12.2')"
      is_expand: true
      is_required: false
  - num_simulators: 3
    opts:
      title: "Number of iOS simulators to run in parallel"
      summary: "Lower numbers produce stability/timeouts. 3-4 is the sweet spot for 4-core processors."
      is_expand: true
      is_required: false
  - test_result_env_var: "TEST_RESULTS"
    opts:
      title: "Env Var for test results"
      summary: "This will also produce a '_SLACK' variable for the Slack markdown formatted copy e.g. ('MY_TEST_RESULTS' and 'MY_TEST_RESULTS_SLACK')"
      is_expand: true
      is_required: false
  - retry_only_failed_tests: true
    opts:
      title: "Only retry tests that failed?"
      summary: "When Failure Tolerance > 0, only retry tests that failed."
      is_expand: true
      is_required: false
      value_options:
      - true
      - false
  - failure_tolerance: 0
    opts:
      title: "Failure Tolerance"
      summary: "Number of times to retry on test failures."
      is_expand: true
      is_required: false
  - additional_bluepill_args: ""
    opts:
      title: "Additional bluepill arguments"
      summary: "See https://github.com/linkedin/bluepill for a full list of supported args."
      is_expand: true
      is_required: false
